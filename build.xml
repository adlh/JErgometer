<?xml version="1.0" encoding="UTF-8"?>

<project name="jergometer" default="runJergometer" basedir=".">
	<!-- Locations -->
	<property name="src"                location="src"/>
	<property name="build"              location="build"/>
	<property name="lib"                location="lib"/>
	
	<property name="buildClasses"       location="${build}/classes"/>
	<property name="buildJar"           location="${build}/jergometer.jar"/>
	<property name="rxtxJar"            location="${lib}/RXTXcomm.jar"/>
	
	<path id="libraries">
		<fileset dir="${lib}">
			<include name="*.jar"/>
		</fileset>
	</path>
	
	<target name="osInfo">
		<echo message="os.name: ${os.name}"/>
		<echo message="os.arch: ${os.arch}"/>
		<echo message="os.version: ${os.version}"/>
	</target> 
	
	<!-- Run application. -->
	<target name="runJergometer" depends="osInfo,compile">
		<java classname="org.jergometer.Jergometer" fork="true">
			<classpath>
				<pathelement location="${buildClasses}" /> 
				<path refid="libraries"/>
			</classpath>
			<jvmarg value="-Djava.library.path=${lib}/dlls/${os.name}/${os.arch}" />
<!--			<jvmarg value="-Djava.util.logging.config.file=conf/logging.properties" />-->
		</java>
	</target>
	
	<!-- Delete class and jar files. -->
	<target name="clean">
		<delete dir="${buildClasses}"/>
		<delete file="${buildJar}"/>
		<delete dir="${build}"/>
	</target>
	
	<!-- Compile application. -->
	<target name="compile">
		<mkdir dir="${buildClasses}"/>
		
		<!-- Compile the project. -->
		<javac srcdir="${src}" destdir="${buildClasses}" target="1.5" source="1.5" encoding="UTF-8" debug="on">
			<classpath>
				<pathelement location="${buildClasses}" />
				<path refid="libraries"/>
			</classpath>
		</javac>
		
		<!-- Copy all non-java files to classes. -->
		<copy todir="${buildClasses}">
			<fileset dir="src">
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
	</target>
	
	<!-- Create jar-file. -->
	<target name="jar" depends="compile">
		<jar jarfile="${buildJar}" basedir="${buildClasses}">
			<manifest>
				<attribute name="Main-Class" value="org.jergometer.Jergometer"/>
			</manifest>
		</jar>
	</target>
</project>
